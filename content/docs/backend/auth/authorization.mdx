## ğŸ§  1. **Authentication vs Authorization**

| Concept        | Authentication                   | Authorization                         |
| -------------- | -------------------------------- | ------------------------------------- |
| **What**       | Who are you?                     | What are you allowed to do?           |
| **Purpose**    | Identity verification            | Access control / Permissions          |
| **Checked by** | Password, Token, OAuth           | Roles, Access Levels, ACL, ABAC, RBAC |
| **When**       | Happens **before** authorization | Happens **after** authentication      |

---

## ğŸ” 2. **Types of Authorization Systems**

### âœ… Role-Based Access Control (RBAC)

- Users are assigned **roles** (e.g., `admin`, `editor`, `user`)
- Each role has permissions to perform certain actions

```ts
// Example
role: 'admin' â†’ can manage users, update settings
role: 'user' â†’ can view profile only
```

### âœ… Attribute-Based Access Control (ABAC)

- Access is based on **attributes** of user or resource
- More dynamic, fine-grained (e.g., `user.department === resource.department`)

```ts
if (user.department === document.ownerDepartment) {
  allowAccess();
}
```

### âœ… Access Control Lists (ACL)

- Permissions are defined **per object/resource**
- Each resource defines who can access or modify it

```ts
document.acl = ['user123', 'user789'];
```

### âœ… Ownership-Based Access

- Users can only access **their own** resources

```ts
if (user.id === resource.ownerId) {
  allowAccess();
}
```

---

## âš™ï¸ 3. **Authorization Methods in Code**

### ğŸ”‘ 1. Middleware Based on Roles (RBAC)

```ts
// Role-based middleware
const authorizeRoles = (...allowedRoles: string[]) => {
  return (req, res, next) => {
    const role = req.user?.role;
    if (!role || !allowedRoles.includes(role)) {
      return res.status(403).json({ message: 'Forbidden' });
    }
    next();
  };
};

// Usage
app.get('/admin', jwtMiddleware, authorizeRoles('admin'), (req, res) => {
  res.json({ message: 'Welcome Admin' });
});
```

---

### ğŸ”‘ 2. Ownership-Based Access

```ts
app.get('/documents/:id', jwtMiddleware, async (req, res) => {
  const doc = await Document.findById(req.params.id);
  if (!doc) return res.status(404).json({ message: 'Not found' });

  if (doc.ownerId !== req.user.id) {
    return res.status(403).json({ message: 'Access denied' });
  }

  res.json(doc);
});
```

---

### ğŸ”‘ 3. Attribute-Based Access (ABAC)

```ts
app.get('/projects/:id', jwtMiddleware, async (req, res) => {
  const project = await Project.findById(req.params.id);
  if (!project) return res.status(404).json({ message: 'Not found' });

  if (req.user.department !== project.department && req.user.role !== 'admin') {
    return res.status(403).json({ message: 'Access denied' });
  }

  res.json(project);
});
```

---

## ğŸ§¾ 4. Summary Table

| Auth Type | Granularity       | Flexibility | Use Case                                  |
| --------- | ----------------- | ----------- | ----------------------------------------- |
| RBAC      | Medium (by role)  | Easy        | Admin/user dashboards                     |
| ABAC      | High (by context) | Flexible    | Enterprise systems, document-level access |
| ACL       | High              | Specific    | Filesystems, cloud object storage         |
| Ownership | Simple            | Strict      | User profile, orders, documents           |

---

## ğŸ§° 5. Best Practices

- ğŸ” Always **authenticate before authorizing**
- ğŸ­ Use **RBAC** for basic admin/user separation
- ğŸ§© Use **ABAC or ACL** for fine-grained resource control
- ğŸ§¾ Keep role/permissions in token payload for JWT
- âš ï¸ Avoid hardcoded role checks all over â€” centralize logic in **middleware**
- âœ… Validate ownership where necessary
